<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Messaging Dashboard - WhatsApp API</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .navbar-brand {
            font-weight: bold;
        }
        .card {
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .danger-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        .success-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        .warning-card {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }
        .feature-card {
            height: 100%;
            border-left: 4px solid;
            transition: all 0.3s ease;
        }
        .feature-card:hover {
            border-left-width: 8px;
        }
        .feature-card.templates {
            border-left-color: #007bff;
        }
        .feature-card.audience {
            border-left-color: #28a745;
        }
        .feature-card.campaigns {
            border-left-color: #ffc107;
        }
        .feature-card.analytics {
            border-left-color: #dc3545;
        }
        .feature-card.settings {
            border-left-color: #6c757d;
        }
        .feature-card.compliance {
            border-left-color: #17a2b8;
        }
        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fab fa-whatsapp me-2"></i>
                WhatsApp Bulk Messaging
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="bulk-dashboard.html">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="template-builder.html">Templates</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="audience-manager.html">Audience</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="campaign-composer.html">Campaigns</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="bulk-monitor.html">Monitor</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="bulk-settings.html">Settings</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Back to Main</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Page Header -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="h3">Bulk Messaging Dashboard</h1>
                <p class="text-muted">Manage your WhatsApp bulk messaging campaigns with advanced features</p>
            </div>
        </div>

        <!-- System Status Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="card-body text-center">
                        <i class="fas fa-rocket fa-2x mb-2"></i>
                        <h5 class="card-title">Active Campaigns</h5>
                        <h2 id="activeCampaigns">-</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card success-card">
                    <div class="card-body text-center">
                        <i class="fas fa-check-circle fa-2x mb-2"></i>
                        <h5 class="card-title">Messages Sent Today</h5>
                        <h2 id="messagesSentToday">-</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card warning-card">
                    <div class="card-body text-center">
                        <i class="fas fa-users fa-2x mb-2"></i>
                        <h5 class="card-title">Total Audience</h5>
                        <h2 id="totalAudience">-</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card danger-card">
                    <div class="card-body text-center">
                        <i class="fas fa-shield-alt fa-2x mb-2"></i>
                        <h5 class="card-title">Ban Risk</h5>
                        <h2 id="banRisk">-</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Feature Cards -->
        <div class="row mb-4">
            <div class="col-md-4 mb-3">
                <div class="card feature-card templates">
                    <div class="card-body text-center">
                        <div class="feature-icon text-primary">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <h5 class="card-title">Template Builder</h5>
                        <p class="card-text">Create and manage message templates with variables, media, and compliance checking.</p>
                        <a href="template-builder.html" class="btn btn-primary">
                            <i class="fas fa-plus me-2"></i>Manage Templates
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card feature-card audience">
                    <div class="card-body text-center">
                        <div class="feature-icon text-success">
                            <i class="fas fa-users"></i>
                        </div>
                        <h5 class="card-title">Audience Manager</h5>
                        <p class="card-text">Import contacts from CSV, manage DND lists, and organize your audience segments.</p>
                        <a href="audience-manager.html" class="btn btn-success">
                            <i class="fas fa-upload me-2"></i>Manage Audience
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card feature-card campaigns">
                    <div class="card-body text-center">
                        <div class="feature-icon text-warning">
                            <i class="fas fa-paper-plane"></i>
                        </div>
                        <h5 class="card-title">Campaign Composer</h5>
                        <p class="card-text">Create, schedule, and launch bulk messaging campaigns with advanced targeting.</p>
                        <a href="campaign-composer.html" class="btn btn-warning">
                            <i class="fas fa-rocket me-2"></i>Create Campaign
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-4 mb-3">
                <div class="card feature-card analytics">
                    <div class="card-body text-center">
                        <div class="feature-icon text-danger">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <h5 class="card-title">Campaign Monitor</h5>
                        <p class="card-text">Real-time monitoring, analytics, and performance tracking for your campaigns.</p>
                        <a href="bulk-monitor.html" class="btn btn-danger">
                            <i class="fas fa-eye me-2"></i>View Monitor
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card feature-card compliance">
                    <div class="card-body text-center">
                        <div class="feature-icon text-info">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h5 class="card-title">Compliance Center</h5>
                        <p class="card-text">Ensure compliance with WhatsApp policies and avoid account bans.</p>
                        <a href="compliance-center.html" class="btn btn-info">
                            <i class="fas fa-check-shield me-2"></i>Check Compliance
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card feature-card settings">
                    <div class="card-body text-center">
                        <div class="feature-icon text-secondary">
                            <i class="fas fa-cog"></i>
                        </div>
                        <h5 class="card-title">System Settings</h5>
                        <p class="card-text">Configure throttling, warmup mode, and other system parameters.</p>
                        <a href="bulk-settings.html" class="btn btn-secondary">
                            <i class="fas fa-wrench me-2"></i>Manage Settings
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-clock me-2"></i>Recent Activity
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="recentActivity">
                            <div class="text-center text-muted">
                                <i class="fas fa-spinner fa-spin"></i>
                                Loading recent activity...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Load system status
                const statusResponse = await fetch('/api/bulk/status');
                const statusData = await statusResponse.json();
                
                // Update status cards
                document.getElementById('activeCampaigns').textContent = 
                    Object.keys(statusData.activeCampaigns || {}).length;
                
                document.getElementById('messagesSentToday').textContent = 
                    statusData.throttling?.stats?.sentToday || 0;
                
                document.getElementById('banRisk').textContent = 
                    statusData.banRisk?.riskLevel?.toUpperCase() || 'LOW';
                
                // Update ban risk card color
                const banRiskCard = document.getElementById('banRisk').closest('.card');
                const riskLevel = statusData.banRisk?.riskLevel || 'low';
                banRiskCard.className = 'card ' + (riskLevel === 'high' ? 'danger-card' : 
                                                   riskLevel === 'medium' ? 'warning-card' : 'success-card');
                
                // Load audience count
                const audienceResponse = await fetch('/api/bulk/audiences?limit=1');
                const audienceData = await audienceResponse.json();
                document.getElementById('totalAudience').textContent = 
                    audienceData.pagination?.total || 0;
                
                // Load recent campaigns for activity
                const campaignsResponse = await fetch('/api/bulk/campaigns?limit=5');
                const campaignsData = await campaignsResponse.json();
                
                const activityDiv = document.getElementById('recentActivity');
                if (campaignsData.campaigns && campaignsData.campaigns.length > 0) {
                    // Clear existing content
                    activityDiv.innerHTML = '';
                    
                    // Safely render each campaign
                    campaignsData.campaigns.forEach(campaign => {
                        const campaignDiv = document.createElement('div');
                        campaignDiv.className = 'd-flex justify-content-between align-items-center py-2 border-bottom';
                        
                        const leftDiv = document.createElement('div');
                        
                        const nameStrong = document.createElement('strong');
                        nameStrong.textContent = campaign.name;
                        leftDiv.appendChild(nameStrong);
                        
                        const templateSpan = document.createElement('span');
                        templateSpan.className = 'text-muted ms-2';
                        templateSpan.textContent = campaign.template?.name || 'Unknown Template';
                        leftDiv.appendChild(templateSpan);
                        
                        campaignDiv.appendChild(leftDiv);
                        
                        const rightDiv = document.createElement('div');
                        rightDiv.className = 'text-end';
                        
                        const statusBadge = document.createElement('span');
                        statusBadge.className = `badge bg-${getStatusColor(campaign.status)}`;
                        statusBadge.textContent = campaign.status;
                        rightDiv.appendChild(statusBadge);
                        
                        const timeDiv = document.createElement('div');
                        timeDiv.className = 'small text-muted';
                        timeDiv.textContent = new Date(campaign.createdAt).toLocaleDateString();
                        rightDiv.appendChild(timeDiv);
                        
                        campaignDiv.appendChild(rightDiv);
                        activityDiv.appendChild(campaignDiv);
                    });
                } else {
                    activityDiv.textContent = 'No recent campaigns found';
                    activityDiv.className = 'text-center text-muted';
                }
                
            } catch (error) {
                document.querySelectorAll('[id$="Count"], [id$="Today"], [id$="Risk"], [id$="Audience"], [id$="Campaigns"]')
                    .forEach(el => el.textContent = 'Error');
            }
        }
        
        function getStatusColor(status) {
            switch(status) {
                case 'running': return 'success';
                case 'scheduled': return 'info';
                case 'paused': return 'warning';
                case 'completed': return 'secondary';
                case 'failed': return 'danger';
                default: return 'primary';
            }
        }
        
        // Auto-refresh every 30 seconds
        setInterval(loadDashboardData, 30000);
        
        // Initial load
        loadDashboardData();
    </script>
</body>
</html>
