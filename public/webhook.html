<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Webhook Configuration - WhatsApp Automation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="assets/styles/app.css">
  <style>
    body { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      min-height: 100vh; 
      padding: 20px;
    }
    .main-container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 10px 50px rgba(0,0,0,0.2);
    }
    .page-header {
      background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
      color: white;
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 30px;
      text-align: center;
    }
    .webhook-card {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 20px;
      border-left: 5px solid #25D366;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
    }
    .form-label {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 10px;
      display: block;
    }
    .form-control, .form-select {
      border: 2px solid #e9ecef;
      border-radius: 10px;
      padding: 12px 15px;
      transition: all 0.3s ease;
    }
    .form-control:focus, .form-select:focus {
      border-color: #25D366;
      box-shadow: 0 0 0 0.2rem rgba(37, 211, 102, 0.25);
    }
    textarea.form-control {
      min-height: 200px;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
    }
    .btn-primary {
      background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
      border: none;
      padding: 12px 30px;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(37, 211, 102, 0.5);
    }
    .btn-secondary {
      background: #6c757d;
      border: none;
      padding: 12px 30px;
      border-radius: 10px;
      font-weight: 600;
    }
    .alert {
      border-radius: 10px;
      border: none;
      padding: 15px 20px;
    }
    .info-box {
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 4px solid #2196F3;
    }
    .webhook-log {
      background: #2c3e50;
      color: #ecf0f1;
      border-radius: 10px;
      padding: 20px;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      max-height: 300px;
      overflow-y: auto;
    }
    .endpoint-box {
      background: white;
      border: 2px dashed #25D366;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      font-family: 'Courier New', monospace;
      word-break: break-all;
    }
  </style>
</head>
<body>
  <div class="main-container">
    <div class="page-header">
      <h1><i class="fas fa-webhook me-2"></i>Webhook Configuration</h1>
      <p class="mb-0">Configure webhooks to receive real-time WhatsApp events</p>
    </div>

    <div class="info-box">
      <h5><i class="fas fa-info-circle me-2"></i>About Webhooks</h5>
      <p class="mb-2">Webhooks allow you to receive real-time notifications when events occur in your WhatsApp account:</p>
      <ul class="mb-0">
        <li><strong>Incoming Messages:</strong> Get notified when someone sends you a message</li>
        <li><strong>Message Status:</strong> Track delivery and read receipts</li>
        <li><strong>Connection Events:</strong> Monitor connection status changes</li>
      </ul>
    </div>

    <div class="webhook-card">
      <h4 class="mb-4"><i class="fas fa-cog me-2"></i>Webhook Endpoint</h4>
      
      <div class="mb-3">
        <label class="form-label">
          <i class="fas fa-link me-1"></i>Your Webhook Endpoint URL
        </label>
        <div class="endpoint-box">
          <strong>POST</strong> http://localhost:3001/webhook
        </div>
        <small class="text-muted">
          <i class="fas fa-lightbulb me-1"></i>This is where WhatsApp events will be sent
        </small>
      </div>

      <form id="webhookForm">
        <div class="mb-4">
          <label class="form-label">
            <i class="fas fa-code me-1"></i>Test Webhook Data (JSON)
          </label>
          <textarea class="form-control" id="webhookData" name="data" required placeholder='{
  "event": "message",
  "from": "1234567890",
  "body": "Test message",
  "timestamp": 1699000000
}'></textarea>
          <small class="text-muted">
            <i class="fas fa-info-circle me-1"></i>Enter valid JSON to test your webhook
          </small>
        </div>

        <div class="d-flex gap-3">
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-paper-plane me-2"></i>Send Test Webhook
          </button>
          <button type="button" class="btn btn-secondary" id="btnClear">
            <i class="fas fa-eraser me-2"></i>Clear
          </button>
          <a href="index.html" class="btn btn-outline-secondary">
            <i class="fas fa-home me-2"></i>Back to Home
          </a>
        </div>
      </form>
    </div>

    <div class="webhook-card" id="resultCard" style="display: none;">
      <h4 class="mb-3">
        <i class="fas fa-terminal me-2"></i>Response
      </h4>
      <div id="result"></div>
    </div>

    <div class="webhook-card">
      <h4 class="mb-3">
        <i class="fas fa-list me-2"></i>Recent Webhook Logs
      </h4>
      <div class="webhook-log" id="webhookLogs">
        <div class="text-muted text-center">No webhook events yet...</div>
      </div>
    </div>

    <div class="webhook-card">
      <h4 class="mb-3">
        <i class="fas fa-book me-2"></i>Example Webhook Payloads
      </h4>
      
      <div class="accordion" id="examplesAccordion">
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#example1">
              <i class="fas fa-comment me-2"></i>Incoming Message Event
            </button>
          </h2>
          <div id="example1" class="accordion-collapse collapse" data-bs-parent="#examplesAccordion">
            <div class="accordion-body">
              <pre class="bg-dark text-light p-3 rounded"><code>{
  "event": "message",
  "from": "1234567890@c.us",
  "body": "Hello, this is a test message",
  "timestamp": 1699000000,
  "type": "chat",
  "isGroup": false
}</code></pre>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#example2">
              <i class="fas fa-check-double me-2"></i>Message Status Event
            </button>
          </h2>
          <div id="example2" class="accordion-collapse collapse" data-bs-parent="#examplesAccordion">
            <div class="accordion-body">
              <pre class="bg-dark text-light p-3 rounded"><code>{
  "event": "message_ack",
  "messageId": "msg123456",
  "ack": "read",
  "timestamp": 1699000000
}</code></pre>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#example3">
              <i class="fas fa-plug me-2"></i>Connection Event
            </button>
          </h2>
          <div id="example3" class="accordion-collapse collapse" data-bs-parent="#examplesAccordion">
            <div class="accordion-body">
              <pre class="bg-dark text-light p-3 rounded"><code>{
  "event": "ready",
  "status": "connected",
  "timestamp": 1699000000
}</code></pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let webhookLogs = [];

    function addLog(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const log = { timestamp, message, type };
      webhookLogs.unshift(log);
      if (webhookLogs.length > 10) webhookLogs.pop();
      
      const logsDiv = document.getElementById('webhookLogs');
      const colorMap = { success: '#2ecc71', error: '#e74c3c', info: '#3498db' };
      const color = colorMap[type] || '#95a5a6';
      
      logsDiv.innerHTML = webhookLogs.map(l => 
        `<div style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #34495e;">
          <span style="color: ${colorMap[l.type]};">[${l.timestamp}]</span> ${l.message}
        </div>`
      ).join('');
    }

    document.getElementById('webhookForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const resultCard = document.getElementById('resultCard');
      const resultDiv = document.getElementById('result');
      
      let data;
      try {
        data = JSON.parse(this.data.value);
        addLog('Parsing JSON... âœ“', 'success');
      } catch (err) {
        resultDiv.innerHTML = `
          <div class="alert alert-danger">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>Invalid JSON:</strong> ${err.message}
          </div>`;
        resultCard.style.display = 'block';
        addLog('JSON parsing failed: ' + err.message, 'error');
        return;
      }

      try {
        addLog('Sending webhook request...', 'info');
        const res = await fetch('/webhook', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        const responseText = await res.text();
        
        if (res.ok) {
          resultDiv.innerHTML = `
            <div class="alert alert-success">
              <i class="fas fa-check-circle me-2"></i>
              <strong>Webhook sent successfully!</strong>
              <hr>
              <div class="webhook-log">Status: ${res.status} ${res.statusText}<br>Response: ${responseText || 'OK'}</div>
            </div>`;
          addLog('Webhook sent successfully (Status: ' + res.status + ')', 'success');
        } else {
          resultDiv.innerHTML = `
            <div class="alert alert-warning">
              <i class="fas fa-exclamation-circle me-2"></i>
              <strong>Webhook sent with status ${res.status}</strong>
              <hr>
              <div class="webhook-log">${responseText}</div>
            </div>`;
          addLog('Webhook response: ' + res.status, 'error');
        }
        
        resultCard.style.display = 'block';
      } catch (err) {
        resultDiv.innerHTML = `
          <div class="alert alert-danger">
            <i class="fas fa-times-circle me-2"></i>
            <strong>Error sending webhook:</strong> ${err.message}
          </div>`;
        resultCard.style.display = 'block';
        addLog('Error: ' + err.message, 'error');
      }
    });

    document.getElementById('btnClear').addEventListener('click', function() {
      document.getElementById('webhookData').value = '';
      document.getElementById('resultCard').style.display = 'none';
    });

    // Add initial log
    addLog('Webhook configuration page loaded', 'success');
  </script>
</body>
</html>
